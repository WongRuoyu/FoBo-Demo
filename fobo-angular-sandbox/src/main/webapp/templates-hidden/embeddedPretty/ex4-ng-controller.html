<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type" />

<title>Embedded pretty template</title>
</head>

<!-- This is an embedded piece of html -->
<body class="lift:content_id=pretty">
<section id="pretty">
<span class="label label-default">assets/js/controllers/personGridCtrl.js - Person grid controller with add function</span>
<pre class="prettyprint linenums js">
app.controller('PersonGridCtrl','$log',function($scope,$log) {
	
  $scope.populate = true;
  $scope.myData = []
	
  $scope.doPopulate = function() {
    $log.debug('PersonGridCtrl:doPopulate: about to call personsQuery');	
    var promise = myRTFunctions.personsQuery();  //Round trip call to Lift server function
    return promise.then(function(data) {
      $scope.$apply(function() {
        $scope.myData = data; 
        $log.debug('PersonGridCtrl:doPopulate: in apply data set'); 
      })
      return data;
    });	 
  };
	
  if($scope.populate){
    $scope.doPopulate();
    $scope.populate = false;
  }   	
    
  $scope.doAdd = function() {
    $log.debug('PersonGridCtrl:doAdd: about to add person ' + $scope.person);
    var json = angular.toJson($scope.person);
    var promise = myRTFunctions.addPersonCmd(json); //send the add data to the 
    $scope.resetPersonFields();
	return promise.then(function(data) {
	   $scope.$apply(function() {
	      $log.debug("PersonGridCtrl:doAdd in $apply data.inserted="+data.inserted);   
          if(data.inserted) {
             $log.debug("PersonGridCtrl:doAdd in $apply repopulate the list"); 	
             $scope.doPopulate();
          }
	   })
	   return data;
    });	
  };  
    
    $scope.resetPersonFields = function() {
    $scope.person = {
            id: 0,
            name: "",
            age: ""
        };        
    }        
  $scope.simpleGridOptions = { 
    data: 'myData',
    enableRowSelection: false,       
    columnDefs: [{field: 'id', visible: false},
                 {field: 'name', displayName: 'Name'}, 
                 {field:'age', displayName:'Age'}]
  };
    
}]);

</pre>
</section>
</body>